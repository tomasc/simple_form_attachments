!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("handlebars/dist/handlebars.min.js"),require("jquery"),require("numeraljs"),require("sortablejs"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/vendor/jquery.ui.widget.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.iframe-transport.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-process.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-validate.js")):"function"==typeof define&&define.amd?define(["handlebars/dist/handlebars.min.js","jquery","numeraljs","sortablejs","imports-loader?define=>false&exports=>false!blueimp-file-upload/js/vendor/jquery.ui.widget.js","imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.iframe-transport.js","imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload.js","imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-process.js","imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-validate.js"],t):"object"==typeof exports?exports["@tomasc/simple_form_attachments"]=t(require("handlebars/dist/handlebars.min.js"),require("jquery"),require("numeraljs"),require("sortablejs"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/vendor/jquery.ui.widget.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.iframe-transport.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-process.js"),require("imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-validate.js")):e["@tomasc/simple_form_attachments"]=t(e["handlebars/dist/handlebars.min.js"],e.jquery,e.numeraljs,e.sortablejs,e["imports-loader?define=>false&exports=>false!blueimp-file-upload/js/vendor/jquery.ui.widget.js"],e["imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.iframe-transport.js"],e["imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload.js"],e["imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-process.js"],e["imports-loader?define=>false&exports=>false!blueimp-file-upload/js/jquery.fileupload-validate.js"])}(window,function(e,t,i,a,s,n,r,l,o){return function(e){var t={};function i(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=6)}([function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t,i){"use strict";(function(e){var a=i(3),s=i.n(a),n=i(0),r=i.n(n),l=i(4),o=i.n(l),_=i(5),u=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};i(21),i(22),i(23),i(24),i(25),t.a=function(){class t extends _.a{constructor(){super(...arguments),this.get_attachment_template=this.get_attachment_template.bind(this),this.get_upload_error_template=this.get_upload_error_template.bind(this)}init(){return this.attachments_counter=0,this.set_unique_ids(),this.get_file_input().on("fileuploadalways.simple_form_attachments",e=>{if(this.is_sortable())return this.init_sortable()}),this.is_sortable()&&this.init_sortable(),this.init_fileupload()}init_sortable(){return this.sortable=new o.a(this.get_attachment_list()[0],this.options.sortable_options)}init_fileupload(){return this.options.debug&&console.log("init jQuery.fileupload"),this.get_file_input().fileupload({dataType:"json",dropZone:this.$element,formData:{"attachment_type]":this.get_attachment_type_input().val(),"attachment_parent[name]":this.get_attachment_parent_name_input().val(),"attachment_parent[class]":this.get_attachment_parent_class_input().val(),"attachment_relation[type]":this.get_attachment_relation_type_input().val(),"attachment_relation[key]":this.get_attachment_relation_key_input().val(),"attachment_relation[name]":this.get_attachment_relation_name_input().val(),"attachment_relation[referenced]":this.get_attachment_relation_referenced_input().val(),authenticity_token:e('meta[name="csrf-token"]').attr("content"),"attachment_relation[multiple]":this.is_multiple()},namespace:"simple_form_attachments",url:this.get_attachments_path(),acceptFileTypes:this.get_accept_file_types(),maxFileSize:this.get_max_file_size(),minFileSize:this.get_min_file_size(),maxNumberOfFiles:this.get_max_number_of_files(),add:(t,i)=>(this.options.debug&&this.set_logs(t,i),this.is_multiple()||this.get_attachment_list().find(".simple_form_attachments__attachment").remove(),i.process(()=>this.get_file_input().fileupload("process",i)),!t.isDefaultPrevented()&&(i.autoUpload||!1!==i.autoUpload&&this.get_file_input().fileupload("option","autoUpload")?(i.process().done(()=>{var t,a,s,n,r,l,o;for(s=0,n=(l=i.files).length;s<n;s++)r={error:(a=l[s]).error,mime_type:a.type,multiple:this.is_multiple(),size:a.size,size_human:this.get_size_human(a.size),thumb_url:URL.createObjectURL(a)},o=e.extend({},a,r),t=this.get_attachment_template(o).addClass("simple_form_attachments__attachment__is_uploading"),i.context=t,t.data("data",i),this.get_attachment_list().append(t);return i.submit()}),i.process().fail(()=>{var t,a,s,n,r,l,o,_;for(_=[],s=0,n=(l=i.files).length;s<n;s++)r={error:(a=l[s]).error,mime_type:a.type,multiple:this.is_multiple(),size:a.size,size_human:this.get_size_human(a.size),thumb_url:URL.createObjectURL(a)},o=e.extend({},a,r),t=this.get_upload_error_template(o),i.context=t,t.data("data",i),_.push(this.get_attachment_list().append(t));return _})):void 0)),start:(e,t)=>(this.options.debug&&this.set_logs(e,t),this.disable_form_submit()),fail:(t,i)=>{var a;if(this.options.debug&&this.set_logs(t,i),i.jqXHR.responseText)return(a=e(JSON.parse(i.jqXHR.responseText).html).addClass("simple_form_attachments__attachment__has_error")).find(".simple_form_attachments__attachment__col__errors"),i.context.replaceWith(a)},progress:(e,t)=>{var i;return this.options.debug&&this.set_logs(e,t),i=parseInt(t.loaded/t.total*100,10),t.context.find(".simple_form_attachments__attachment__col__progress__bar").width(i+"%")},done:(t,i)=>{var a;return this.options.debug&&this.set_logs(t,i),this.options.debug&&console.log(i.result.html),a=e(i.result.html).addClass("simple_form_attachments__attachment__is_uploaded"),i.context.replaceWith(a)},stop:(e,t)=>(this.options.debug&&this.set_logs(e,t),this.enable_form_submit())}),this.$element.on("click.simple_form_attachments",".simple_form_attachments__button__delete, .simple_form_attachments__button__close, .simple_form_attachments__button__dismiss",t=>{var i;return t.preventDefault(),t.stopPropagation(),i=e(t.currentTarget).closest(".simple_form_attachments__attachment"),this.remove_template(i)}),this.$element.on("click.simple_form_attachments",".simple_form_attachments__button__cancel",t=>{var i,a;return t.preventDefault(),t.stopPropagation(),a=(i=e(t.currentTarget).closest(".simple_form_attachments__attachment")).data("data")||{},this.enable_form_submit(),a.jqXHR?a.jqXHR.abort():(a.errorThrown="abort",t.data.fileupload._trigger("fail",t,a)),this.remove_template(i)}),this.$element.on("dragover.simple_form_attachments",e=>(e.preventDefault(),this.$element.addClass("dragover"))),this.$element.on("dragleave.simple_form_attachments",e=>(e.preventDefault(),this.$element.removeClass("dragover"))),this.$element.on("drop.simple_form_attachments",e=>(e.preventDefault(),this.$element.removeClass("dragover")))}destroy(){return this.get_file_input().off(".simple_form_attachments"),this.$element.off(".simple_form_attachments")}get_accept_file_types(){var e,t,i;if(e=this.$element.data("accept-file-types")){for(t=0,i=e.length;t<i;t++)e[t].replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(e.join("|"),"i")}}get_max_file_size(){return this.$element.data("max-file-size")}get_min_file_size(){return this.$element.data("min-file-size")}get_max_number_of_files(){return this.$element.data("max-number-of-files")}get_attachment_list(){return this.$element.find(".simple_form_attachments__attachment_list")}get_attachments_path(){return this.$element.data("attachments-path")}get_disabled_submit_text(){return this.$element.data("disabled-submit-text")}get_file_input(){return this.$element.find("input.file")}get_form(){return this.$element.parents("form").first()}get_form_submit(){return this.get_form().find('input[type="submit"]').first()}get_number_of_files(){return this.get_attachment_list().children(".simple_form_attachments__attachment").not(".simple_form_attachments__attachment__has_error").length}get_attachment_type_input(){return this.$element.find('input[name="attachment_type"]')}get_attachment_multiple_input(){return this.$element.find('input[name="attachment[multiple]"]')}get_attachment_parent_class_input(){return this.$element.find('input[name="attachment_parent[class]"]')}get_attachment_parent_name_input(){return this.$element.find('input[name="attachment_parent[name]"]')}get_attachment_relation_key_input(){return this.$element.find('input[name="attachment_relation[key]"]')}get_attachment_relation_name_input(){return this.$element.find('input[name="attachment_relation[name]"]')}get_attachment_relation_type_input(){return this.$element.find('input[name="attachment_relation[type]"]')}get_attachment_relation_referenced_input(){return this.$element.find('input[name="attachment_relation[referenced]"]')}get_relation_name(){return this.$element.data("relation-name")}get_relation_key(){return this.$element.data("relation-key")}get_size_human(e){return s()(e).format("0.0 b")}get_attachment_template(i){var a;return u(this,t),a=r.a.compile(this.$element.find("script#simple_form_attachments__attachment_template").html()),e(a(i))}get_upload_error_template(i){var a;return u(this,t),a=r.a.compile(this.$element.find("script#simple_form_attachments__upload_error_template").html()),e(a(i))}set_logs(e,t){return console.log(e.type),console.log(e),console.log(t)}enable_form_submit(){var e,t;return t=(e=this.get_form_submit()).data("submit-text"),e.removeAttr("disabled"),e.val(t)}disable_form_submit(){var e;return(e=this.get_form_submit()).attr("data-submit-text",e.val()),e.val(this.get_disabled_submit_text()).attr("disabled","disabled")}remove_template(t){return t.slideUp(this.options.slide_speed).promise().done(function(){return e(this).remove()})}create_index(){return(new Date).getTime()+this.attachments_counter++}is_multiple(){return void 0!==this.get_file_input().attr("multiple")}is_sortable(){return this.get_attachment_list().hasClass("simple_form_attachments__attachment_list__is_sortable")}set_unique_ids(){var e,t,i,a;return i=(e=this.get_file_input()).attr("id"),t=this.$element.find(`[for='${i}']`),e.data("default-id",i),t.data("default-for",i),a=`${i}__${this.guid()}`,e.attr("id",a),t.attr("for",a)}guid(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}}return t.defaults={name:"SimpleFormAttachments",debug:!1,sortable_options:{animation:150,draggable:".simple_form_attachments__attachment",forcePlaceholderSize:!0,ghostClass:"simple_form_attachments__attachment__ghost",handle:".simple_form_attachments__attachment__col__handle"},slide_speed:"fast"},t}()}).call(this,i(1))},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t,i){"use strict";(function(e){t.a=class{static register(){var e,t,i,a;return this,t=(e=null!=(i=this.defaults)?i:{}).name||(e.name=/function ([^(]*)/.exec(this+"")[1]),Array.prototype.slice.call(arguments).slice(1),null!=(a=arguments[0])?a:this.selector,this.init_plugin(this,t)}static init_plugin(t,i){if(void 0===e.fn[i])return e.fn[i]=function(e){var a,s,n;return a=arguments,s=`plugin_${i}`,void 0===e||"object"==typeof e?this.each(function(){var i;if(this.pluginInstances||(this.pluginInstances={}),!this.pluginInstances[s])return i=new t(this,e),this.pluginInstances[s]=i}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(n=void 0,this.each(function(){var i;if(this.pluginInstances||(this.pluginInstances={}),(i=this.pluginInstances[s])instanceof t&&"function"==typeof i[e]&&(n=i[e].apply(i,Array.prototype.slice.call(a,1))),"destroy"===e)return this.pluginInstances[s]=null}),void 0!==n?n:this):void 0}}constructor(t,i){this.element=t,this.options=e.extend({},this.constructor.defaults,i),this.$element=e(this.element),this.init()}}}).call(this,i(1))},function(e,t,i){"use strict";i.r(t);i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20);var a=i(2);t.default=a.a},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t,i){},function(e,t){e.exports=s},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=l},function(e,t){e.exports=o}])});